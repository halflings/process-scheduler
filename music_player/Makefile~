ROOT_DIR=.
include common.mk

.PHONY: start hw scheduler music

all : kernel run

clean : common_clean
	cd hw && make clean
	cd music && make clean
	cd scheduler && make clean
	cd start && make clean

hw:
	cd hw && make

start:
	cd start && make

scheduler:
	cd $(SCHED_DIR) && make && cd ../music_player

music:
	cd music && make

kernel.elf : hw start music scheduler start/memmap notmain.o
	$(LD) start/vectors.o notmain.o music/music.a hw/hw.a $(SCHED_DIR)/sched.a -T start/memmap -o kernel.elf $(LD_FLAGS)

kernel : kernel.elf
	$(OBJCOPY) kernel.elf -O binary kernel.img
	cp kernel.img SD_Card/
	$(OBJDUMP) -D kernel.elf > kernel.list
	
run :
	cd debug; gnome-terminal -x ./run-qemu.sh; ./launch-gdb.sh;
